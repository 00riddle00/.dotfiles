(function() {
  var HEADING_REGEX, JumpTo, REFERENCE_REGEX, TABLE_COL_REGEX, utils;

  utils = require("../utils");

  HEADING_REGEX = /^\#{1,6} +.+$/;

  REFERENCE_REGEX = /\[([^\[\]]+)(?:\]|\]:)/;

  TABLE_COL_REGEX = /([^\|]*?)\s*\|/;

  module.exports = JumpTo = (function() {
    function JumpTo(command) {
      this.command = command;
      this.editor = atom.workspace.getActiveTextEditor();
      this.cursor = this.editor.getCursorBufferPosition();
    }

    JumpTo.prototype.trigger = function(e) {
      var fn, range;
      fn = this.command.replace(/-[a-z]/ig, function(s) {
        return s[1].toUpperCase();
      });
      range = this[fn]();
      if (range) {
        return this.editor.setCursorBufferPosition(range);
      } else {
        return e.abortKeyBinding();
      }
    };

    JumpTo.prototype.previousHeading = function() {
      var found, range;
      range = [[0, 0], [this.cursor.row - 1, 0]];
      found = false;
      this.editor.buffer.backwardsScanInRange(HEADING_REGEX, range, function(match) {
        found = match.range.start;
        return match.stop();
      });
      return found;
    };

    JumpTo.prototype.nextHeading = function() {
      var eof, range;
      eof = this.editor.getEofBufferPosition();
      range = this._findNextHeading([[this.cursor.row + 1, 0], [eof.row + 1, 0]]) || this._findNextHeading([[0, 0], [eof.row + 1, 0]]);
      return range;
    };

    JumpTo.prototype._findNextHeading = function(range) {
      var found;
      found = false;
      this.editor.buffer.scanInRange(HEADING_REGEX, range, function(match) {
        found = match.range.start;
        return match.stop();
      });
      return found;
    };

    JumpTo.prototype.referenceDefinition = function() {
      var found, link, range, selection;
      range = utils.getTextBufferRange(this.editor, "link", {
        selectBy: "currentLine"
      });
      if (link = utils.findLinkInRange(this.editor, range)) {
        if (!link.id) {
          return false;
        }
        if (!link.linkRange || !link.definitionRange) {
          return false;
        }
        if (link.linkRange.start.row !== this.cursor.row && link.linkRange.end.row !== this.cursor.row) {
          return [link.linkRange.start.row, link.linkRange.start.column];
        } else {
          return [link.definitionRange.start.row, link.definitionRange.start.column];
        }
      } else {
        selection = this.editor.getTextInRange(range);
        if (!selection) {
          return false;
        }
        link = REFERENCE_REGEX.exec(selection);
        if (!link) {
          return false;
        }
        found = false;
        this.editor.buffer.scan(RegExp("\\[" + (utils.escapeRegExp(link[1])) + "\\]", "g"), (function(_this) {
          return function(match) {
            if (match.range.start.row !== _this.cursor.row && match.range.end.row !== _this.cursor.row) {
              found = [match.range.start.row, match.range.start.column];
              return match.stop();
            }
          };
        })(this));
        return found;
      }
    };

    JumpTo.prototype.nextTableCell = function() {
      var line;
      line = this.editor.lineTextForBufferRow(this.cursor.row);
      if (utils.isTableRow(line) || utils.isTableSeparator(line)) {
        return this._findNextTableCell(line, this.cursor.row, this.cursor.column);
      } else {
        return false;
      }
    };

    JumpTo.prototype._findNextTableCell = function(currentLine, row, column) {
      var td;
      column = currentLine.indexOf("|", column);
      if (column === -1 || column === currentLine.length - 1) {
        row += 1;
        column = 0;
        currentLine = this.editor.lineTextForBufferRow(row);
      }
      if (utils.isTableSeparator(currentLine)) {
        row += 1;
        column = 0;
        currentLine = this.editor.lineTextForBufferRow(row);
      }
      if (currentLine === void 0) {
        return false;
      }
      if (currentLine[column] === "|") {
        column += 1;
        currentLine = currentLine.slice(column);
      }
      if (td = TABLE_COL_REGEX.exec(currentLine)) {
        return [row, column + td[1].length];
      } else {
        return [row, column + currentLine.length];
      }
    };

    return JumpTo;

  })();

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvcmlkZGxlLy5hdG9tL3BhY2thZ2VzL21hcmtkb3duLXdyaXRlci9saWIvY29tbWFuZHMvanVtcC10by5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBOztFQUFBLEtBQUEsR0FBUSxPQUFBLENBQVEsVUFBUjs7RUFFUixhQUFBLEdBQWtCOztFQUNsQixlQUFBLEdBQWtCOztFQUNsQixlQUFBLEdBQWtCOztFQUVsQixNQUFNLENBQUMsT0FBUCxHQUNNO0lBQ1MsZ0JBQUMsT0FBRDtNQUNYLElBQUMsQ0FBQSxPQUFELEdBQVc7TUFDWCxJQUFDLENBQUEsTUFBRCxHQUFVLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQWYsQ0FBQTtNQUNWLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBQyxDQUFBLE1BQU0sQ0FBQyx1QkFBUixDQUFBO0lBSEM7O3FCQUtiLE9BQUEsR0FBUyxTQUFDLENBQUQ7QUFDUCxVQUFBO01BQUEsRUFBQSxHQUFLLElBQUMsQ0FBQSxPQUFPLENBQUMsT0FBVCxDQUFpQixVQUFqQixFQUE2QixTQUFDLENBQUQ7ZUFBTyxDQUFFLENBQUEsQ0FBQSxDQUFFLENBQUMsV0FBTCxDQUFBO01BQVAsQ0FBN0I7TUFDTCxLQUFBLEdBQVEsSUFBRSxDQUFBLEVBQUEsQ0FBRixDQUFBO01BRVIsSUFBRyxLQUFIO2VBQ0UsSUFBQyxDQUFBLE1BQU0sQ0FBQyx1QkFBUixDQUFnQyxLQUFoQyxFQURGO09BQUEsTUFBQTtlQUdFLENBQUMsQ0FBQyxlQUFGLENBQUEsRUFIRjs7SUFKTzs7cUJBU1QsZUFBQSxHQUFpQixTQUFBO0FBQ2YsVUFBQTtNQUFBLEtBQUEsR0FBUSxDQUFDLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBRCxFQUFTLENBQUMsSUFBQyxDQUFBLE1BQU0sQ0FBQyxHQUFSLEdBQWMsQ0FBZixFQUFrQixDQUFsQixDQUFUO01BRVIsS0FBQSxHQUFRO01BQ1IsSUFB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QU87UUFDUCxNQUFBLEdBQVM7UUFDVCxXQUFBLEdBQWMsSUFBQyxDQUFBLE1BQU0sQ0FBQyxvQkFBUixDQUE2QixHQUE3QixFQUhoQjs7TUFNQSxJQUFHLEtBQUssQ0FBQyxnQkFBTixDQUF1QixXQUF2QixDQUFIO1FBQ0UsR0FBQSxJQUFPO1FBQ1AsTUFBQSxHQUFTO1FBQ1QsV0FBQSxHQUFjLElBQUMsQ0FBQSxNQUFNLENBQUMsb0JBQVIsQ0FBNkIsR0FBN0IsRUFIaEI7O01BTUEsSUFBZ0IsV0FBQSxLQUFlLE1BQS9CO0FBQUEsZUFBTyxNQUFQOztNQUdBLElBQUcsV0FBWSxDQUFBLE1BQUEsQ0FBWixLQUF1QixHQUExQjtRQUNFLE1BQUEsSUFBVTtRQUNWLFdBQUEsR0FBYyxXQUFZLGVBRjVCOztNQUtBLElBQUcsRUFBQSxHQUFLLGVBQWUsQ0FBQyxJQUFoQixDQUFxQixXQUFyQixDQUFSO2VBQ0UsQ0FBQyxHQUFELEVBQU0sTUFBQSxHQUFTLEVBQUcsQ0FBQSxDQUFBLENBQUUsQ0FBQyxNQUFyQixFQURGO09BQUEsTUFBQTtlQUdFLENBQUMsR0FBRCxFQUFNLE1BQUEsR0FBUyxXQUFXLENBQUMsTUFBM0IsRUFIRjs7SUF6QmtCOzs7OztBQW5GdEIiLCJzb3VyY2VzQ29udGVudCI6WyJ1dGlscyA9IHJlcXVpcmUgXCIuLi91dGlsc1wiXG5cbkhFQURJTkdfUkVHRVggICA9IC8vLyBeXFwjIHsxLDZ9IFxcICsgLiskIC8vL1xuUkVGRVJFTkNFX1JFR0VYID0gLy8vIFxcWyAoW15cXFtcXF1dKykgKD86XFxdfFxcXTopIC8vL1xuVEFCTEVfQ09MX1JFR0VYID0gLy8vIChbXlxcfF0qPykgXFxzKiBcXHwgLy8vXG5cbm1vZHVsZS5leHBvcnRzID1cbmNsYXNzIEp1bXBUb1xuICBjb25zdHJ1Y3RvcjogKGNvbW1hbmQpIC0+XG4gICAgQGNvbW1hbmQgPSBjb21tYW5kXG4gICAgQGVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKVxuICAgIEBjdXJzb3IgPSBAZWRpdG9yLmdldEN1cnNvckJ1ZmZlclBvc2l0aW9uKClcblxuICB0cmlnZ2VyOiAoZSkgLT5cbiAgICBmbiA9IEBjb21tYW5kLnJlcGxhY2UoLy1bYS16XS9pZywgKHMpIC0+IHNbMV0udG9VcHBlckNhc2UoKSlcbiAgICByYW5nZSA9IEBbZm5dKClcblxuICAgIGlmIHJhbmdlXG4gICAgICBAZWRpdG9yLnNldEN1cnNvckJ1ZmZlclBvc2l0aW9uKHJhbmdlKVxuICAgIGVsc2VcbiAgICAgIGUuYWJvcnRLZXlCaW5kaW5nKClcblxuICBwcmV2aW91c0hlYWRpbmc6IC0+XG4gICAgcmFuZ2UgPSBbWzAsIDBdLCBbQGN1cnNvci5yb3cgLSAxLCAwXV1cblxuICAgIGZvdW5kID0gZmFsc2VcbiAgICBAZWRpdG9yLmJ1ZmZlci5iYWNrd2FyZHNTY2FuSW5SYW5nZSBIRUFESU5HX1JFR0VYLCByYW5nZSwgKG1hdGNoKSAtPlxuICAgICAgZm91bmQgPSBtYXRjaC5yYW5nZS5zdGFydFxuICAgICAgbWF0Y2guc3RvcCgpXG4gICAgcmV0dXJuIGZvdW5kXG5cbiAgbmV4dEhlYWRpbmc6IC0+XG4gICAgZW9mID0gQGVkaXRvci5nZXRFb2ZCdWZmZXJQb3NpdGlvbigpXG5cbiAgICByYW5nZSA9XG4gICAgICAjIGZpbmQgdG8gZW5kIG9mIGZpbGVcbiAgICAgIEBfZmluZE5leHRIZWFkaW5nKFtbQGN1cnNvci5yb3cgKyAxLCAwXSwgW2VvZi5yb3cgKyAxLCAwXV0pIHx8XG4gICAgICAjIGZpbmQgYXJvdW5kIHRoZSB0b3Agb2YgZmlsZVxuICAgICAgQF9maW5kTmV4dEhlYWRpbmcoW1swLCAwXSwgW2VvZi5yb3cgKyAxLCAwXV0pXG5cbiAgICByZXR1cm4gcmFuZ2VcblxuICBfZmluZE5leHRIZWFkaW5nOiAocmFuZ2UpIC0+XG4gICAgZm91bmQgPSBmYWxzZVxuICAgIEBlZGl0b3IuYnVmZmVyLnNjYW5JblJhbmdlIEhFQURJTkdfUkVHRVgsIHJhbmdlLCAobWF0Y2gpIC0+XG4gICAgICBmb3VuZCA9IG1hdGNoLnJhbmdlLnN0YXJ0XG4gICAgICBtYXRjaC5zdG9wKClcbiAgICByZXR1cm4gZm91bmRcblxuICByZWZlcmVuY2VEZWZpbml0aW9uOiAtPlxuICAgIHJhbmdlID0gdXRpbHMuZ2V0VGV4dEJ1ZmZlclJhbmdlKEBlZGl0b3IsIFwibGlua1wiLCBzZWxlY3RCeTogXCJjdXJyZW50TGluZVwiKVxuXG4gICAgaWYgbGluayA9IHV0aWxzLmZpbmRMaW5rSW5SYW5nZShAZWRpdG9yLCByYW5nZSlcbiAgICAgIHJldHVybiBmYWxzZSBpZiAhbGluay5pZCAjIG5vcm1hbCBsaW5rXG4gICAgICByZXR1cm4gZmFsc2UgaWYgIWxpbmsubGlua1JhbmdlIHx8ICFsaW5rLmRlZmluaXRpb25SYW5nZSAjIG9ycGhhbiBsaW5rXG5cbiAgICAgIGlmIGxpbmsubGlua1JhbmdlLnN0YXJ0LnJvdyAhPSBAY3Vyc29yLnJvdyAmJiBsaW5rLmxpbmtSYW5nZS5lbmQucm93ICE9IEBjdXJzb3Iucm93XG4gICAgICAgIHJldHVybiBbbGluay5saW5rUmFuZ2Uuc3RhcnQucm93LCBsaW5rLmxpbmtSYW5nZS5zdGFydC5jb2x1bW5dXG4gICAgICBlbHNlXG4gICAgICAgIHJldHVybiBbbGluay5kZWZpbml0aW9uUmFuZ2Uuc3RhcnQucm93LCBsaW5rLmRlZmluaXRpb25SYW5nZS5zdGFydC5jb2x1bW5dXG5cbiAgICBlbHNlXG4gICAgICBzZWxlY3Rpb24gPSBAZWRpdG9yLmdldFRleHRJblJhbmdlKHJhbmdlKVxuICAgICAgcmV0dXJuIGZhbHNlIHVubGVzcyBzZWxlY3Rpb25cblxuICAgICAgbGluayA9IFJFRkVSRU5DRV9SRUdFWC5leGVjKHNlbGVjdGlvbilcbiAgICAgIHJldHVybiBmYWxzZSB1bmxlc3MgbGlua1xuXG4gICAgICBmb3VuZCA9IGZhbHNlXG4gICAgICBAZWRpdG9yLmJ1ZmZlci5zY2FuIC8vLyBcXFsgI3t1dGlscy5lc2NhcGVSZWdFeHAobGlua1sxXSl9IFxcXSAvLy9nLCAobWF0Y2gpID0+XG4gICAgICAgIGlmIG1hdGNoLnJhbmdlLnN0YXJ0LnJvdyAhPSBAY3Vyc29yLnJvdyAmJiBtYXRjaC5yYW5nZS5lbmQucm93ICE9IEBjdXJzb3Iucm93XG4gICAgICAgICAgZm91bmQgPSBbbWF0Y2gucmFuZ2Uuc3RhcnQucm93LCBtYXRjaC5yYW5nZS5zdGFydC5jb2x1bW5dXG4gICAgICAgICAgbWF0Y2guc3RvcCgpXG4gICAgICByZXR1cm4gZm91bmRcblxuICBuZXh0VGFibGVDZWxsOiAtPlxuICAgIGxpbmUgPSBAZWRpdG9yLmxpbmVUZXh0Rm9yQnVmZmVyUm93KEBjdXJzb3Iucm93KVxuXG4gICAgaWYgdXRpbHMuaXNUYWJsZVJvdyhsaW5lKSB8fCB1dGlscy5pc1RhYmxlU2VwYXJhdG9yKGxpbmUpXG4gICAgICBAX2ZpbmROZXh0VGFibGVDZWxsKGxpbmUsIEBjdXJzb3Iucm93LCBAY3Vyc29yLmNvbHVtbilcbiAgICBlbHNlXG4gICAgICBmYWxzZVxuXG4gIF9maW5kTmV4dFRhYmxlQ2VsbDogKGN1cnJlbnRMaW5lLCByb3csIGNvbHVtbikgLT5cbiAgICAjIGZpbmQgdGhlIG5leHQgY29sdW1uIHNlcGFyYXRvciBvbiBjdXJyZW50IGxpbmVcbiAgICBjb2x1bW4gPSBjdXJyZW50TGluZS5pbmRleE9mKFwifFwiLCBjb2x1bW4pXG5cbiAgICAjIHdoZW4gYXQgdGhlIGxhc3QgY29sdW1uIG9mIGN1cnJlbnQgbGluZVxuICAgIGlmIGNvbHVtbiA9PSAtMSB8fCBjb2x1bW4gPT0gY3VycmVudExpbmUubGVuZ3RoIC0gMVxuICAgICAgcm93ICs9IDFcbiAgICAgIGNvbHVtbiA9IDBcbiAgICAgIGN1cnJlbnRMaW5lID0gQGVkaXRvci5saW5lVGV4dEZvckJ1ZmZlclJvdyhyb3cpXG5cbiAgICAjIHdoZW4gY3VycmVudCBsaW5lIGlzIHRhYmxlIHNlcGFyYXRvclxuICAgIGlmIHV0aWxzLmlzVGFibGVTZXBhcmF0b3IoY3VycmVudExpbmUpXG4gICAgICByb3cgKz0gMVxuICAgICAgY29sdW1uID0gMFxuICAgICAgY3VycmVudExpbmUgPSBAZWRpdG9yLmxpbmVUZXh0Rm9yQnVmZmVyUm93KHJvdylcblxuICAgICMgZXhjZWVkcyB0aGUgcm93IG9mIGN1cnJlbnQgZG9jdW1lbnRcbiAgICByZXR1cm4gZmFsc2UgaWYgY3VycmVudExpbmUgPT0gdW5kZWZpbmVkXG5cbiAgICAjIHNraXAgdGhlIHBpcGVcbiAgICBpZiBjdXJyZW50TGluZVtjb2x1bW5dID09IFwifFwiXG4gICAgICBjb2x1bW4gKz0gMVxuICAgICAgY3VycmVudExpbmUgPSBjdXJyZW50TGluZVtjb2x1bW4uLl1cblxuICAgICMgZmluZCB0aGUgY29ycmVjdCBjZWxsIGNvbHVtbiBieSBsZW5ndGhcbiAgICBpZiB0ZCA9IFRBQkxFX0NPTF9SRUdFWC5leGVjKGN1cnJlbnRMaW5lKVxuICAgICAgW3JvdywgY29sdW1uICsgdGRbMV0ubGVuZ3RoXVxuICAgIGVsc2VcbiAgICAgIFtyb3csIGNvbHVtbiArIGN1cnJlbnRMaW5lLmxlbmd0aF1cbiJdfQ==
