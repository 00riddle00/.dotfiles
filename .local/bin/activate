#!/usr/bin/env bash
# vim:ft=bash:tw=79
#------------------------------------------------------------------------------
# Author: 00riddle00 [Tomas Giedraitis]
# Date:   2024-04-04 23:50:52 EEST
# Path:   ~/.local/bin/activate
# URL:    https://github.com/00riddle00/dotfiles
#------------------------------------------------------------------------------
#*
# ...
#
# USAGE:
#     activate brave
#     activate qalculate-gtk -n qalculate
#     activate qalculate-gtk -e -n 'Qalculate!'
#     activate pycharm -c jetbrains-pycharm
#     activate thunar -e -c "thunar.Thunar"
#
# Last checked with:
# wmctrl v1.07
#**

POSITIONAL_ARGS=()

while [[ $# -gt 0 ]]; do
  case $1 in
    -c|--class)
      WIN_CLASS="$2"
      shift
      shift
      ;;
    -e|--exact)
        EXACT=true
        shift
        ;;
    -n|--name)
      WIN_NAME="$2"
      shift
      shift
      ;;
    -*|--*)
      echo "Unknown option $1"
      exit 1
      ;;
    *)
      POSITIONAL_ARGS+=("$1")
      shift
      ;;
  esac
done

set -- "${POSITIONAL_ARGS[@]}"

if [[ -z "$1" ]]; then
    echo "No command to launch a program provided."
    exit 1
fi

COMMAND="${1}"

if [[ -z "${WIN_NAME}" && -z "${WIN_CLASS}" ]]; then
    WIN_NAME="${1}"
fi

if [[ -n "${EXACT}" ]]; then
    echo EXAC
    if [[ -n "${WIN_CLASS}" ]]; then
        echo winclas
        if wmctrl -l -x | awk '{print $3}' | grep -q "^${WIN_CLASS}$"; then
            # Window by class found (exact match), raise and focus it.
            wmctrl -F -x -a "${WIN_CLASS}"
        else
            # No window found, launch the program.
            "${COMMAND}"
        fi
    else
        if wmctrl -l | tr -s ' ' | cut -d ' ' -f4- | grep -q "^${WIN_NAME}$" ; then
            # Window by title found (exact match), raise and focus it.
            wmctrl -F -a "${WIN_NAME}"
        else
            # No window found, launch the program.
            "${COMMAND}"
        fi
    fi
else
    if [[ -n "${WIN_CLASS}" ]]; then
        if wmctrl -l -x | awk '{print $3}' | grep -iq "${WIN_CLASS}"; then
            # Window by class found (fuzzy match), raise and focus it.
            wmctrl -x -a "${WIN_CLASS}"
        else
            # No window found, launch the program.
            "${COMMAND}"
        fi
    else
        if wmctrl -l | tr -s ' ' | cut -d ' ' -f4- | grep -iq "${WIN_NAME}" ; then
            # Window by title found (fuzzy match), raise and focus it.
            wmctrl -a "${WIN_NAME}"
        else
            # No window found, launch the program.
            "${COMMAND}"
        fi
    fi
fi
